<!doctype html>
<html style="overflow: hidden;">
<head>
<meta charset="utf-8">
<meta name="viewport" content="wispanh=device-wispanh, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>购物车</title>
<link href="../../css/common.css" type="text/css" rel="stylesheet" /> 
<link href="../../css/shopcar.css" type="text/css" rel="stylesheet" />

<script type="text/javascript" src="../../js/jquery.js"></script>
<script src="../../js/retailerid.js"></script>
<script>
	$(document).ready(function(){
		$.get("/webapi/account/login/test-2-135-1",{},function(){},false);
		var _list="";
		var _give="";
		var _color="";
		var _distrgive="";
		var _id="";
		var _count=0;
		var _save=0;
		var _arr=[];
		var _price=0;
		var _discount=0;
		var _Id=[];
		var _tt="";
		var _active="";
		var _dll=0;
		var _disId="";
		var _sv=[];
		var _dis=0
		var _pp=0;
		var _ct=0;
		var _qu=0;
		var _ges=0;
		var _cun=0;
		var _indd=localStorage.index
		_disId=location.search.replace("distributor_id=","").replace("?","");
		localStorage.disId=_disId
		console.log(_disId)
			_tt=JSON.parse(localStorage.retalerdata).data;
			console.log(_tt)
			
			$.ajax({
				url:"/webapi/distributor/"+getRetailerid()+"/shoppingcart/"+_disId+"?isvalid=0",
				async:true,
		    	cache:false,
		        dataType:"json",
		        type:"get",
		        error:function(){},
		        success:function(data1){
		        	console.log(data1)
		        	show(data1)
		        }
			})
		function aa(){
			$(".commit").css({background:"#009f96",width:"24%"})
			$(".commit").html("去提交"+"<span>("+_ges+")</span>")
			console.log(_Id)
			_qu=0
			
				$(".commit").click(function(){
					if(_qu==0){
						localStorage.Id=_Id.join(",").replace(/\,+$/g,"").replace(/^\,+/,"")
						location.href="commit.html"
					}
				})	
			
		
		}
					function zz(){
						if(_price<_tt[_indd]["cutgift"]){
							_qu=1;
							$(".commit").css({background:"#ccc",width:"auto"})
							$(".commit").text("还差 "+(_tt[_indd]["cutgift"]-_price)+" 元起送")
						}else{
							aa()
						}						
					}
		function show(data1){
			

			
			$(".addr").text("clienton")//需要修改
			var _name="";
			var _index=0;
			var _tell="";
			var _remark="";
			var _intr="";
			var _dd=""
			for(var i=0;i<data1.length;i++){
						if(data1[i]["guid"]){
							_dd=data1[i]["guid"]
						}else{
							_dd=data1[i]["itemguid"]
						}
				if(data1[i]["itemcount"]==1){
					_color="#dbdfe4"
				}else{
					_color="#009f96"
				}
				if(data1[i]["isyucun"]==1){
					console.log(11)
					_image="<img class="+"\"img2\" "+"src="+"../../image/shop/yu.jpg"+" />"
				}else if(data1[i]["itemquality"]===0){
					_image="<img class="+"\"img2\" "+"src="+"../../image/shop/temp.jpg"+" />"
				}else{
					_image=""
				}
				console.log(_image)
				if(data1[i]["remark"]!=""){
					_remark="<div class="+"\"disc\""+"><div>备注：<b>"+data1[i]["remark"]+"</b></div></div>"
				}else{
					_remark=""
				}
				_intr="";
				if(data1[i]["salestop"]==0){
					if(!data1[i]["itemslist"]){
						if(data1[i]["specification"]==null && data1[i]["packagetypename"]!==null){
							_intr=data1[i]["packagetypename"]
						}else if(data1[i]["packagetypename"]==null && data1[i]["specification"]!==null){
							_intr=data1[i]["specification"]
						}else if(data1[i]["specification"]!==null && data1[i]["packagetypename"]!==null){
							_intr=data1[i]["specification"]+" | "+data1[i]["packagetypename"]
						}else{
							intr=""
						}					
					}else{
						if(data1[i]["itemslist"][data1[i]["selectedindex"]]["specification"]==null && data1[i]["itemslist"][data1[i]["selectedindex"]]["packagetypename"]!==null){
							_intr=data1[i]["itemslist"][data1[i]["selectedindex"]]["packagetypename"]
						}else if(data1[i]["itemslist"][data1[i]["selectedindex"]]["packagetypename"]==null && data1[i]["itemslist"][data1[i]["selectedindex"]]["specification"]!==null){
							_intr=data1[i]["itemslist"][data1[i]["selectedindex"]]["specification"]
						}else if(data1[i]["itemslist"][data1[i]["selectedindex"]]["specification"]!==null && data1[i]["itemslist"][data1[i]["selectedindex"]]["packagetypename"]!==null){
							_intr=data1[i]["itemslist"][data1[i]["selectedindex"]]["specification"]+" | "+data1[i]["itemslist"][data1[i]["selectedindex"]]["packagetypename"]
						}else{
							intr=""
						}					
					}
				}

				_name=data1[i]["itemslist"]?data1[i]["itemslist"][data1[i]["selectedindex"]]["itemname"]:data1[i]["itemname"]
				if(!data1[i]["itemslist"]){
					if(data1[i]["activityitem_id"]=="" && data1[i]["salestop"]==0 && data1[i]["isyucun"]==0){
						_price+=Number(data1[i]["price"])*Number(data1[i]["itemcount"]);
						_count++;
						_ges+=Number(data1[i]["itemcount"])
						_arr.push(i)
						_Id.push(data1[i]["guid"])
						_list+="<li id=\""+i+"\""+" ip="+(_arr.length-1)+" guid="+_dd+"><div class="+"\"list\""+"><i class="+"\"gouxuan\" flag="+"\"1\""+"></i><div class="+"\"conh\""+"><div class="+"\"yuu\""+"><img class="+"\"img1\" "+"src="+data1[i]["itemimage"]+" /><div class="+"\"yoo\""+">"+_image+_name+"</div><p class="+"\"pl\""+">"+_intr+"</p><div class="+"\"change\""+"><span class="+"\"increase\""+">+</span><span class="+"\"amount\""+">"+data1[i]["itemcount"]+"</span><span class="+"\"reduce\" style="+"\"color:"+_color+"\""+">-</span></div><p class="+"\"pp1\""+">￥"+data1[i]["price"]+"</p></p></div></div></div>"+_remark+"<div class="+
						"\"set\""+"style="+"\"width:100%;height:4rem;border-top:1px solid #ededed\""+"><span>留言</span><span class="+"\"delete\""+">删除</span></div></li>"
					}else if(data1[i]["itemkind"]=="降价" && data1[i]["salestop"]==0){
						_price+=Number(data1[i]["price"])*Number(data1[i]["itemcount"]);
						_count++;
						_ges+=Number(data1[i]["itemcount"])
						_arr.push(i)
						_Id.push(data1[i]["guid"])
						_discount+=(data1[i]["originalprice"]-data1[i]["price"])*data1[i]["itemcount"]
						_list+="<li id=\""+i+"\""+" ip="+(_arr.length-1)+" guid="+_dd+"><div class="+"\"list\""+"><i class="+"\"gouxuan\" flag="+"\"1\""+"></i><div class="+"\"conh\""+"><div class="+"\"yuu\""+"><img class="+"\"img1\" "+"src="+data1[i]["itemimage"]+" /><div class="+"\"yoo\""+">"+_image+_name+"</div><p class="+"\"pl\""+">"+_intr+"</p><div class="+"\"change\""+"><span class="+"\"increase\""+">+</span><span class="+"\"amount\""+">"+data1[i]["itemcount"]+"</span><span class="+"\"reduce\" style="+"\"color:"+_color+"\""+">-</span></div><p class="+"\"pp1\""+">￥"+data1[i]["discountprice"]+"</p><p class="+"\"intail\""+"><span>￥"+data1[i]["originalprice"]+"</span></p></p></div></div></div><div class="+"\"disc\""+
						"><span>降价</span><span> "+data1[i]["discount"]+" 折</span></div>"+_remark+"<div class="+
						"\"set\""+"style="+
						"\"width:100%;height:4rem;border-top:1px solid #ededed\""+"><span>留言</span><span class="+"\"delete\""+">删除</span></div></li>"
					}else if(data1[i]["itemkind"]=="折扣" && data1[i]["salestop"]==0){
						_price+=Number(data1[i]["price"])*Number(data1[i]["itemcount"]);
						_count++;
						_ges+=Number(data1[i]["itemcount"])
						_arr.push(i)
						_Id.push(data1[i]["guid"])
						_discount+=(data1[i]["originalprice"]-data1[i]["price"])*data1[i]["itemcount"]
						_list+="<li id=\""+i+"\""+" ip="+(_arr.length-1)+" guid="+_dd+"><div class="+"\"list\""+"><i class="+"\"gouxuan\" flag="+"\"1\""+"></i><div class="+"\"conh\""+"><div class="+"\"yuu\""+"><img class="+"\"img1\" "+"src="+data1[i]["itemimage"]+" /><div class="+"\"yoo\""+">"+_image+_name+"</div><p class="+"\"pl\""+">"+_intr+"</p><div class="+"\"change\""+"><span class="+"\"increase\""+">+</span><span class="+"\"amount\""+">"+data1[i]["itemcount"]+"</span><span class="+"\"reduce\" style="+"\"color:"+_color+"\""+">-</span></div><p class="+"\"pp1\""+">￥"+data1[i]["price"]*data1[i]["discount"]+"</p><p class="+"\"intail\""+"><span>￥"+data1[i]["price"]+"</span></p></p></div></div></div><div class="+"\"disc\""+" id="+"\"disc\""+
						"><span>折扣</span><span>"+data1[i]["discount"]+"</span></div>"+_remark+"<div class="+
						"\"set\""+"style="+
						"\"width:100%;height:4rem;border-top:1px solid #ededed\""+"><span>留言</span><span class="+"\"delete\""+">删除</span></div></li>"
					}else if(data1[i]["itemkind"]=="有礼" && data1[i]["salestop"]==0){
						_price+=Number(data1[i]["price"])*Number(data1[i]["itemcount"]);
						_count++;
						_ges+=Number(data1[i]["itemcount"])
						_arr.push(i)
						_Id.push(data1[i]["guid"])
						_list+="<li id=\""+i+"\""+" ip="+(_arr.length-1)+" guid="+_dd+"><div class="+"\"list\""+"><i class="+"\"gouxuan\" flag="+"\"1\""+"></i><div class="+"\"conh\""+"><div class="+"\"yuu\""+"><img class="+"\"img1\" "+"src="+data1[i]["itemimage"]+" /><div class="+"\"yoo\""+">"+_image+_name+"</div><p class="+"\"pl\""+">"+_intr+"</p><div class="+"\"change\""+"><span class="+"\"increase\""+">+</span><span class="+"\"amount\""+">"+data1[i]["itemcount"]+"</span><span class="+"\"reduce\" style="+"\"color:"+_color+"\""+">-</span></div><p class="+"\"pp1\""+">￥"+data1[i]["price"]+"</p></p></div></div></div><div class="+"\"disc\""+
						"><span>有礼</span><span> 购买"+data1[i]["salecount"]+data1[i]["packagetypename"]+data1[i]["itemname"]+"赠送"+
							data1[i]["giftcount"]+data1[i]["giftitemobj"]["packagetypename"]+data1[i]["giftitemobj"]["itemname"]+"</span></div>"+_remark+"<div class="+
						"\"set\""+"style="+
						"\"width:100%;height:4rem;border-top:1px solid #ededed\""+"><span>留言</span><span class="+"\"delete\""+">删除</span></div></li>"					
					}else if(data1[i]["itemkind"]=="买赠" && data1[i]["salestop"]==0){
						_count++;
						_ges+=Number(data1[i]["itemcount"])
						_arr.push(i)
						_Id.push(data1[i]["guid"])
						_price+=Number(data1[i]["price"])*Number(data1[i]["itemcount"]);
						_list+="<li id=\""+i+"\""+" ip="+(_arr.length-1)+" guid="+_dd+"><div class="+"\"list\""+"><i class="+"\"gouxuan\" flag="+"\"1\""+"></i><div class="+"\"conh\""+"><div class="+"\"yuu\""+"><img class="+"\"img1\" "+"src="+data1[i]["itemimage"]+" /><div class="+"\"yoo\""+">"+_image+_name+"</div><p class="+"\"pl\""+">"+_intr+"</p><div class="+"\"change\""+"><span class="+"\"increase\""+">+</span><span class="+"\"amount\""+">"+data1[i]["itemcount"]+"</span><span class="+"\"reduce\" style="+"\"color:"+_color+"\""+">-</span></div><p class="+"\"pp1\""+">￥"+data1[i]["price"]+"</p></p></div></div></div><div class="+"\"disc\""+
						"><span>买赠</span><span> 买"+data1[i]["salecount"]+data1[i]["giftitemobj"]["packagetypename"]+data1[i]["itemname"]+"赠"+data1[i]["giftcount"]+data1[i]["giftitemobj"]["packagetypename"]+data1[i]["giftitemobj"]["itemname"]+"</span></div>"+_remark+"<div class="+"\"giveTo\""+"><b style="+"\"margin-right:5px\""+">赠品</b><div><span>"+data1[i]["giftitemobj"]["itemname"]+"</span><span>1"+data1[i]["giftitemobj"]["packagetypename"]+"</span></div></div><div class="+
						"\"set\""+"style="+"\"width:100%;height:4rem;border-top:1px solid #ededed\""+"><span>留言</span><span class="+"\"delete\""+">删除</span></div></li>"						
					}else if(data1[i]["isyucun"]==1 && data1[i]["salestop"]==0){
						console.log(1)
						_price+=Number(data1[i]["price"])*Number(data1[i]["itemcount"]);
						_count++;
						_ges+=Number(data1[i]["itemcount"])
						_arr.push(i)
						_Id.push(data1[i]["guid"])
						_list+="<li id=\""+i+"\""+" ip="+(_arr.length-1)+" guid="+_dd+"><div class="+"\"list\""+"><i class="+"\"gouxuan\" flag="+"\"1\""+"></i><div class="+"\"conh\""+"><div class="+"\"yuu\""+"><img class="+"\"img1\" "+"src="+data1[i]["itemimage"]+" /><div class="+"\"yoo\""+">"+_image+_name+"</div><p class="+"\"pl\""+">"+_intr+"</p><div class="+"\"change\""+"><span class="+"\"increase\""+">+</span><span class="+"\"amount\""+">"+data1[i]["itemcount"]+"</span><span class="+"\"reduce\" style="+"\"color:"+_color+"\""+">-</span></div><p class="+"\"pp1\""+">￥"+data1[i]["price"]+"</p><span class="+"\"pi\""+">￥"+data1[i]["itemunitcost"].toFixed(2)+"<span style="+"\"display:inline-block;width:1.4rem;height:1.4rem;border-radius:50%;text-align:center;border:1px solid #ccc\""+
						">预</span></span><p style="+"\"padding-left:82px\""+">可提"+data1[i]["prepaycount"]+data1[i]["packagetypename"]+"</p></p></div></div></div>"+_remark+"<div class="+
						"\"set\""+"style="+"\"width:100%;height:4rem;border-top:1px solid #ededed\""+"><span>留言</span><span class="+"\"delete\""+">删除</span></div></li>"
					}else if(data1[i]["salestop"]==1){
						_list+="<li id=\""+i+"\" style="+"\"position:relative\""+"><div class="+"\"list\""+"><b class="+"\"gouxuan2\""+"></b><div class="+"\"conh\""+"><div class="+"\"yuu\""+"><img class="+"\"img1\" "+"src="+data1[i]["itemimage"]+" /><div class="+"\"yoo\""+">"+_image+data1[i]["itemname"]+"</div><p class="+"\"pl\""+">"+_intr+"</p><div class="+"\"change\""+"><span class="+"\"increase\""+">+</span><span class="+"\"amount\""+">"+data1[i]["itemcount"]+"</span><span class="+"\"reduce\" style="+"\"color:"+_color+"\""+">-</span></div><p class="+"\"pp1\""+">￥"+data1[i]["price"]+"</p></p></div></div></div><div class="+
						"\"set\""+"style="+"\"width:100%;height:4rem;border-top:1px solid #ededed\""+"><span>留言</span><span class="+"\"delete\""+">删除</span></div><div style="+
						"\"position:absolute;left:0;top:0;width:100%;height:95px;background:#ddd;opacity:0.5\""+"></div><img src="+"\"../../image/shop/shopcart_down.png\""+" style="+"\"position:absolute;width:4rem;right:0;top:0\""+"></li>"
					}					
				}else{
					_index=data1[i]["selectedindex"];
					if(data1[i]["activityitem_id"]=="" && data1[i]["salestop"]==0){
						_price+=Number(data1[i]["itemslist"][_index]["price"])*Number(data1[i]["itemcount"]);
						_count++;
						_ges+=Number(data1[i]["itemcount"])
						_arr.push(i)
						_Id.push(data1[i]["guid"])
						_list+="<li id=\""+i+"\""+" ip="+(_arr.length-1)+" guid="+_dd+"><div class="+"\"list\""+"><i class="+"\"gouxuan\" flag="+"\"1\""+"></i><div class="+"\"conh\""+"><div class="+"\"yuu\""+"><img class="+"\"img1\" "+"src="+data1[i]["itemslist"][_index]["itemimage"]+" /><div class="+"\"yoo\""+">"+_image+_name+"</div><p class="+"\"pl\""+">"+_intr+"</p><div class="+"\"change\""+"><span class="+"\"increase\""+">+</span><span class="+"\"amount\""+">"+data1[i]["itemcount"]+"</span><span class="+"\"reduce\" style="+"\"color:"+_color+"\""+">-</span></div><p class="+"\"pp1\""+">￥"+data1[i]["itemslist"][_index]["price"]+"</p></p></div></div></div>"+_remark+"<div class="+
						"\"set\""+"style="+"\"width:100%;height:4rem;border-top:1px solid #ededed\""+"><span>留言</span><span class="+"\"delete\""+">删除</span></div></li>"
					}else if(data1[i]["salestop"]==1){
						_list+="<li id=\""+i+"\" style="+"\"position:relative\""+"><div class="+"\"list\""+"><b class="+"\"gouxuan2\""+"></b><div class="+"\"conh\""+"><div class="+"\"yuu\""+"><img class="+"\"img1\" "+"src="+data1[i]["itemimage"]+" /><div class="+"\"yoo\""+">"+_image+data1[i]["itemslist"][_index]["itemname"]+"</div><p class="+"\"pl\""+">"+_intr+"</p><div class="+"\"change\""+"><span class="+"\"increase\""+">+</span><span class="+"\"amount\""+">"+data1[i]["itemcount"]+"</span><span class="+"\"reduce\" style="+"\"color:"+_color+"\""+">-</span></div><p class="+"\"pp1\""+">￥"+data1[i]["price"]+"</p></p></div></div></div><div class="+
						"\"set\""+" style="+"\"width:100%;height:4rem;border-top:1px solid #ededed\""+"><span>留言</span><span class="+"\"delete\""+">删除</span></div><div style="+
						"\"position:absolute;left:0;top:0;width:100%;height:100%;background:#ddd;opacity:0.5\""+"></div></li>"
					}
				}
				for(var z=0;z<_Id.length;z++){
					_sv[z]=_Id[z]
				}
			}
					zz()
			_save=_count;
			_dis=_discount
			_pp=_price
			_ct=_count
			_cun=_ges
			//_Id=_Id.join(",").replace(/\,$/,"")


			if(_distrgive!=""){
				$(".giveto").css({display:"block"})
				$(".gift").html(_distrgive)
			}
			$("section ul").html(_list)
			$(".summ").text("("+_ges+")")

			$(".amountBig span").text(_price.toFixed(1))
			$(".commit span").text("("+_ges+")")
			select()
			change(data1);
			deLete(data1)
			console.log(_discount)
			$(".ab span:nth-child(2)").text(_discount.toFixed(1))
			fg()
		}
			function deLete(data1){
				var _dl="";
				$("#edit").click(function(){
					if($(".set").css("display")=="none"){
						$(".set").css({display:"block"})
					}else{
						$(".set").css({display:"none"})
					}
				})
				$(".delete").click(function(){
					_dll=$(this).parent().parent().find(".amount").text()
					$(".ifDelt").css({display:"block"})
					$("html").css({overflow:"hidden"})
					$(".ifDelt div:nth-child(1)").attr("id","y"+$(this).parent().parent().attr("id"))
					$(".ifDelt div:nth-child(1)").attr("ip",$(this).parent().parent().attr("ip"))
					_arr.splice($(this).parent().parent().attr("ip"),1,-2)
				})
				$(".ifDelt span:nth-child(1)").click(function(){
					$(".ifDelt").css({display:"none"})
					$("html").css({overflow:"auto"})
				})
				$(".ifDelt span:nth-child(2)").click(function(){
					_id=$(this).parent().prev().attr("id").replace("y","");
					 
					_dl=data1[_id]["guid"]
					 
					console.log(_dl)
					$.ajax({
						url:"/webapi/distributor/"+getRetailerid()+"/shoppingcart?distributor_id="+_disId+"&guid="+_dl,
						type:"delete",
						error:function(){alert("网络出错")},
						success:function(data){
							console.log(data)
							//$(".delete").remove($(".delete").parent().parent())
							$("html").css({overflow:"auto"})
							$(".ifDelt").css({display:"none"})
							$("#"+_id).remove()
							if(data1[_id]["salestop"]==0){
								console.log(_id)
								_price-=Number(data1[_id]["price"])*Number(_dll)
								console.log(_price)
							}
							$(".amountBig span").text(_price.toFixed(1))
							fg()
//							if(){
//								
//							}
						}
					})
				})
			}
    	//}
    	function sendId(data1){
			$.ajax({
				url:"/webapi/distributor/"+getRetailerid()+"/shoppingcart/"+data1[_indd]["distributor_id"]+"?isvalid=0",
				dataType:"json",
				type:"get",
				error:function(){alert("网络出错")},
				success:function(){
					alert(1)
				}
			})		
    	}

		function select(){
			var _ll=0;

			console.log(_arr)
			$("section").on('click','.gouxuan',function(){
				if($(this).attr("flag")==1){
					_Id.splice($(this).parent().parent().attr("ip"),1,"")
					console.log(_Id)
					$(this).attr("flag","0")
					$(this).css({"background":"none",borderColor:"#5d5c5c"});
					_arr.splice($(this).parent().parent().attr("ip"),1,-1)
					console.log(_arr)
					_count-=1
					_ges-=Number($(this).next().children().children().find(".amount").text())
					_price-=Number($(this).parent().find(".pp1").text().replace("￥",""))*Number($(this).next().find(".amount").text())
					if($(this).parent()){
						if($(this).parent().next().find("span:nth-child(1)").text()=="降价"){
							_discount-=(Number($(this).next().children().find(".intail").find("span").text().replace("￥",""))-Number($(this).next().children().find(".pp1").text().replace("￥","")))*Number($(this).next().find(".change").find(".amount").text())
							$(".amountBig").next().find("span:nth-child(2)").text(_discount.toFixed(2))
						}
					}
					zz()
					$(".amountBig span").text(_price.toFixed(1))
//					if(_count==0){
//						$(".yj").css({display:"block"})
//					}
				}else{
					if($(this).parent()){
						if($(this).parent().next().find("span:nth-child(1)").text()=="降价"){
							_discount+=(Number($(this).next().children().find(".intail").find("span").text().replace("￥",""))-Number($(this).next().children().find(".pp1").text().replace("￥","")))*Number($(this).next().find(".change").find(".amount").text())
							$(".amountBig").next().find("span:nth-child(2)").text(_discount.toFixed(2))
						}
					}
					_Id.splice($(this).parent().parent().attr("ip"),1,$(this).parent().parent().attr("guid"))
					console.log(_Id)
					_arr.splice($(this).parent().parent().attr("ip"),1,parseInt($(this).parent().parent().attr("id")))
					console.log(_arr)
					$(this).attr("flag","1")
					$(this).css({"background":"url(../../image/shop/crect1.jpg) no-repeat center center",backgroundSize:"1.4rem 1.4rem",borderColor:"#fff"});
					_count+=1
					_ges+=Number($(this).next().children().children().find(".amount").text())
					_price+=Number($(this).parent().find(".pp1").text().replace("￥",""))*Number($(this).next().find(".amount").text())
					$(".amountBig span").text(_price.toFixed(1))
					zz()
//					if(_count>0){
//						$(".yj").css({display:"none"})
//					}
					
				}

				if(_count==_save){
					$(".gg").attr("flag","1")
					$(".gg").css({"background":"url(../../image/shop/crect.jpg) no-repeat center center",backgroundSize:"1.4rem 1.4rem",borderColor:"#3a3635"});
				}else{
					$(".gg").attr("flag","0")
					$(".gg").css({"background":"none",borderColor:"#fff"});
				}
				$(".commit span").text("("+_ges+")")
				$(".summ").text("("+_ges+")")
				fg()
			});
			$(".all").on('click','.gg',function(){
				if($(this).attr("flag")==1){
					_count=0;
					_ges=0
					$(".commit span").text("("+_ges+")")
					$(".summ").text("("+_ges+")")
					$(this).attr("flag","0")
					$(this).css({"background":"none",borderColor:"#fff"});
					for(var k=0;k<$(".list i").length;k++){
						
							$(".list i")[k].setAttribute("style","background:none;border-color:#5d5c5c;")
							$(".list i")[k].setAttribute("flag","0")
//							$(".list i")[k].style.background="none";
//							$(".list i")[k].style.borderColor
							//$(".list i")[j].css({"background":"url(../../image/shop/crect1.jpg) no-repeat center center",backgroundSize:"1.4rem 1.4rem",borderColor:"#fff"});
										
					}
					_count=0
					$(".amountBig span").text("0.0")
					_price=0
					zz()
					_discount=0
					$(".amountBig").next().find("span:nth-child(2)").text("0.0")
//					if(_count==0){
//						$(".yj").css({display:"block"})
//					}
					for(var c=0;c<_Id.length;c++){
						_Id[c]=""
					}
					console.log(_Id)
				}else{
					_price=_pp
					zz()
					_discount=_dis
					_count=_ct
					_ges=_cun
					$(".commit span").text("("+_ges+")")
					$(".summ").text("("+_ges+")")
					$(this).attr("flag","1")
					$(this).css({"background":"url(../../image/shop/crect.jpg) no-repeat center center",backgroundSize:"1.4rem 1.4rem",borderColor:"#3a3635"});
						for(var j=0;j<$(".list i").length;j++){
						
							$(".list i")[j].setAttribute("style","background:url(../../image/shop/crect1.jpg) no-repeat center center;background-size:1.4rem 1.4rem;borderColor:#fff;flag:1")
							$(".list i")[j].setAttribute("flag","1")
							//$(".list i")[j].css({"background":"url(../../image/shop/crect1.jpg) no-repeat center center",backgroundSize:"1.4rem 1.4rem",borderColor:"#fff"});
										
					}
					_count=_save
					$(".amountBig span").text(_price.toFixed(1))
					$(".amountBig").next().find("span:nth-child(2)").text(_discount.toFixed(1))
//					if(_count>0){
//						$(".yj").css({display:"none"})
//					}
					console.log(_sv)
					for(var f=0;f<_sv.length;f++){
						_Id[f]=_sv[f]
					}
					console.log(_Id)
				}
				fg()
			});
		}
		function change(data1){
			$(".change").on('click','.reduce',function(){
				var tht=this					
				var _ind=$(this).parent().parent().parent().parent().parent().attr("id");
				var that=$(this).parent().find(".amount").text()
				console.log(data1[_ind]["salecount"])
				if(data1[_ind]["salecount"]){
					if($(this).parent().find(".amount").text()>data1[_ind]["salecount"]){
						$(this).parent().find(".amount").text($(this).parent().find(".amount").text()-1);
						that=$(this).parent().find(".amount").text()
						$.ajax({
							type:"post",
							url:"/webapi/distributor/"+getRetailerid()+"/shoppingcart",
							async:true,
							data:{
								distributorid:_disId,
								itemid:data1[_ind]["itemid"],
								itemcount:that,
								itemquality:data1[_ind]["itemquality"],
								itemprice:data1[_ind]["price"],
								isyucun:data1[_ind]["isyucun"],
								activityitemid:data1[_ind]["activityitem_id"],
								versiontime:formaty(),
								remark:""	
							},
							error:function(){},
							success:function(data){
								console.log(data);
								if($(tht).parent().parent().parent().prev().attr("flag")==1){
									_price-=Number($(tht).parent().parent().find(".pp1").text().replace("￥",""))
									$(".amountBig span").text(_price.toFixed(1))
								}
								if($(tht).parent().parent().parent().parent().next().find("span:nth-child(1)").text()=="降价" && $(tht).parent().parent().parent().prev().attr("flag")==1){
									_discount-=(Number($(tht).parent().next().next().find("span").text().replace("￥",""))-Number($(tht).parent().next().text().replace("￥","")))
									$(".amountBig").next().find("span:nth-child(2)").text(_discount.toFixed(1))
								}
								fg()
							}
						});
					}else{
						$(this).css({color:"#e3e7ea"})
					}
				}else{
					if($(this).parent().find(".amount").text()>1){
						$(this).parent().find(".amount").text($(this).parent().find(".amount").text()-1);
						that=$(this).parent().find(".amount").text()
						$.ajax({
							type:"post",
							url:"/webapi/distributor/"+getRetailerid()+"/shoppingcart",
							async:true,
							data:{
								distributorid:_disId,
								itemid:data1[_ind]["itemid"],
								itemcount:that,
								itemquality:data1[_ind]["itemquality"],
								itemprice:data1[_ind]["price"],
								isyucun:data1[_ind]["isyucun"],
								activityitemid:data1[_ind]["activityitem_id"],
								versiontime:formaty(),
								remark:""	
							},
							error:function(){},
							success:function(data){
								console.log(data);
								if($(tht).parent().parent().parent().prev().attr("flag")==1){
									_price-=Number($(tht).parent().parent().find(".pp1").text().replace("￥",""))
									$(".amountBig span").text(_price.toFixed(1))
								}
								if($(tht).parent().parent().parent().parent().next().find("span:nth-child(1)").text()=="降价" && $(tht).parent().parent().parent().prev().attr("flag")==1){
									_discount-=(Number($(tht).parent().next().next().find("span").text().replace("￥",""))-Number($(tht).parent().next().text().replace("￥","")))
									$(".amountBig").next().find("span:nth-child(2)").text(_discount.toFixed(1))
								}
								fg()
							}
						});						
					}

				}


				
			});
			$(".change").on('click','.increase',function(){
				var th=this;
					$(this).parent().find(".amount").text(parseInt($(this).parent().find(".amount").text())+1)
				if($(this).parent().find(".amount").text()>1){
					$(this).parent().find(".reduce").css({color:"#23aca4"})
				}				
				var _ind=$(this).parent().parent().parent().parent().parent().attr("id");
				var that=$(this).parent().find(".amount").text();
				$.ajax({
					type:"post",
					url:"/webapi/distributor/"+getRetailerid()+"/shoppingcart",
					async:true,
					data:{
						distributorid:_disId,
						itemid:data1[_ind]["itemid"],
						itemcount:that,
						itemquality:data1[_ind]["itemquality"],
						itemprice:data1[_ind]["price"],
						isyucun:data1[_ind]["isyucun"],
						activityitemid:data1[_ind]["activityitem_id"],
						versiontime:formaty(),
						remark:""	
					},
					error:function(){},
					success:function(data){
						console.log(data);
						
						console.log(_price)
						console.log($(th).parent().parent().parent().prev().attr("flag"))
						if($(th).parent().parent().parent().prev().attr("flag")==1){
							_price+=Number($(th).parent().parent().find(".pp1").text().replace("￥",""))
							$(".amountBig span").text(_price.toFixed(1))
						}
						console.log($(th).parent().parent().parent().parent().next().find("span:nth-child(1)"))
						if($(th).parent().parent().parent().parent().next().find("span:nth-child(1)").text()=="降价" && $(th).parent().parent().parent().prev().attr("flag")==1){
							_discount+=(Number($(th).parent().next().next().find("span").text().replace("￥",""))-Number($(th).parent().next().text().replace("￥","")))
							$(".amountBig").next().find("span:nth-child(2)").text(_discount.toFixed(1))
						}
						fg()
					}
				});
			})
		}
		function formaty(){
			var d=new Date();
			_year=d.getFullYear();
			_month=d.getMonth()+1;
			_day=d.getDate();
			_hour=d.getHours();
			_minute=d.getMinutes();
			_second=d.getSeconds();
			_msecond=d.getMilliseconds();
			if(_hour<10){
				_hour="0"+_hour;
			}
			if(_month<10){
				_month="0"+_month;
			}
			if(_day<10){
				_day="0"+_day;
			}
			if(_minute<10){
				_minute="0"+_minute;
			}
			if(_second<10){
				_second="0"+_second;
			}
			if(_msecond<100 && _msecond>10){
				_msecond="0"+_msecond
			}else if(_msecond<10){
				_msecond="00"+_msecond
			}
			return _year+"-"+_month+"-"+_day+" "+_hour+":"+_minute+":"+_second+"."+_msecond
		}

		function fg(){
				console.log(_price)
					var _nm="";
		        	var _jies="";
					if(_tt[_indd]["promotionactivity"] && _tt[_indd]["promotionactivity"]["details"].length>0){
		        	  	for(var p=0;p<_tt[_indd]["promotionactivity"]["details"].length;p++){
		        	  		if(_price>=_tt[_indd]["promotionactivity"]["details"][p]["moneysum"] && _tt[_indd]["itemkind"]=="满赠"){
		        	  			for(var c=0;c<_tt[_indd]["promotionactivity"]["details"][p]["giftitems"].length;c++){
		        	  				_distrgive+="<div>"+_tt[_indd]["promotionactivity"]["details"][p]["giftitems"][c]["itemname"]+"<span class="+"\"gifty\""+">x"+_tt[_indd]["promotionactivity"]["details"][p]["giftitems"][c]["count"]+"</span></div>"
		        	  				_active=_tt[_indd]["promotionactivity"]["details"][p]["giftitems"][c]["itemname"]
		        	  				_nm="满赠"
		        	  				_jies="您已满"+_tt[_indd]["promotionactivity"]["details"][p]["moneysum"]+"元，获赠"
		        	  			}
		        			}else if(_price>=_tt[_indd]["promotionactivity"]["details"][p]["moneysum"] && data[_indd]["itemkind"]=="满减"){
		        				for(var c=0;c<_tt[_indd]["promotionactivity"]["details"][p]["giftitems"].length;c++){
		        	  				_active="<span>"+data[_indd]["promotionactivity"]["details"][p]["moneysum"]+"</span>"
		        	  				_nm="满减"
		        	  				_jies="您已满"+_tt[_indd]["promotionactivity"]["details"][p]["giftitems"][c]["price"]+"元，已减"
		        	  			}
		        			}
						}					
						console.log(_nm)
						if(_active==""){
							$(".intr").css({display:"none"})
						}else{
							$(".intr").css({display:"flex"})
						}
						$(".intr div:nth-child(1)").text(_nm)
						$(".intr div:nth-child(2) span:nth-child(1)").text(_jies)
						$(".intr div:nth-child(2) span:nth-child(2)").text(_active)	
						_nm="";
						 _jies="";
						 _active=""
		        }
					$("html").css({overflow:"auto"})
					$(".loads").css({display:"none"})
		}
	})
</script>
</head>

<body>
	<div class="ifDelt" style="width:100%;height:100%;background:rgba(170,170,170,0.3);position:fixed;bottom:0;display:none;z-index:1000">
		<div style="width:80%;height:10rem;background:#fff;margin:28% 10% 0 10%;border-bottom:1px solid #ccc;line-height: 10rem;text-align: center;font-size:14px">确认要删除这1种商品</div>
		<div>
			<span>取消</span>
			<span>确认</span>
		</div>
	</div>
	<section style="overflow: auto;margin-bottom: 5.3rem;">
		<div class="shop-title">
			<div>购物车<span class="summ">(30)</span></div>
			<div><span id="edit">编辑</span></div>
		</div>
		<div class="addr">
			<span class="gouxuan"></span><div>接口</div>
		</div>
		<div class="intr">
			<div>满赠</div>
			<div><span></span><span></span></div>
		</div>
		<ul style="overflow: hidden;">
			
		</ul>
	</section>

 <!-- footer start -->
    <div class="bottomlayout">
                        
                       
                          
                       
                          
                          <!-- orderlayout 3 description -->
                          
                            <div class="totalsum">
                            	<span class="all"><i flag="1" class="gg"  style="width:1.4rem;height:1.4rem;border:1px solid #3a3635;border-radius: 1.4rem;"></i><span>全选</span></span>
                                          <p class="amountBig" style="margin-left: 0;float:left"> 合计：￥<span>50</span>元</p> 
                                            <p style="margin-left: 0;" class="ab"><span>已优惠金额：￥</span><span>139.00</span>  </p> 
                                            <div class="commit">去提交<span>(20)</span></div>
                                            <!--<div class="yj" style="display:none;position:fixed;right:0;bottom:0;width:24%;height:62px;background:#aaa;opacity: 0.78;"></div>-->
                                      </div>
                            
                          
                          
                          
                         <!--  <div class="bottomsubmit">
                          <input type="button" data-evt="buy-cart-m/biz/go:submit" class="" >去提交(<span class="">20</span>)</input>
                          
                          </div> -->
                        </div>
  <!-- footer end -->
<div class="loads"><img src="../../image/shop/loading.gif" style="width:15%;margin: 70% 0 0 44%"/></div>
</body>
</html>
