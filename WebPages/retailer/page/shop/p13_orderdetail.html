<!DOCTYPE html>
<html >
<head>
    <title>订单详情</title>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta name="aplus-terminal" content="1">
    <link rel="stylesheet" href="../../css/shopcart.css"/>
    <link href="../../css/common.css" rel="stylesheet" type="text/css">
    <link href="../../css/master.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="../../js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="../../js/retailerid.js"></script>

    <script type="text/javascript">

      //解析URL
    function getParam() {
      var urlInfo = window.location.href; //获取当前页面的url  
      var intLen = urlInfo.length; //获取url的长度  
      var offset = urlInfo.indexOf("?"); //设置参数字符串开始的位置  
      var strKeyValue = urlInfo.substr(offset, intLen); //取出参数字符串 这里会获得类似“id=1”这样的字符串  
      var arrParam = strKeyValue.split("="); //对获得的参数字符串按照“=”进行分割  
      var serialnumber = arrParam[1]; //得到参数值 
      var distributor_id = arrParam[3]; //得到参数值 
      // alert("您要传递的参数值是" + strParamValue);  
      //alert(strParamValue);
      var str = new Array(2);
      str[0]=serialnumber;
      str[1]=distributor_id ;
      return str;
    }


  var distributor_id=top.window.parent.distributor_id;
  $(document).ready(function()
  {

     var canshu = new Array(2);
        canshu=getParam();
        serial_number=canshu[0];
        dis_id=canshu[1];

   $.get("http://membership-waibao.ipaloma.com/webapi/account/login/test-2-135-1",{},function(){},false);
   $.ajax({
      url:"h/webapi/distributor/"+getRetailerid()+"/orderforms",
      async:true,
      cache:false,
      dataType:"json",
      type:"get",
      error:function(){alert("网络出错")},
      success:function(data)
       {
        //alert(data);
          for (var j = 0; j < data.length; j++) 
          {

            //过滤分销商
            if (data[j].distributor_id==dis_id) 
            {

                billlist=data[j].billlist;
                for(var i=0;i<billlist.length;i++)  //遍历订单列表  目前总共有三个订单列表
                {
                    //过滤订单列表
                    if(billlist[i].serialnumber==serial_number)
                    {
                        //订单信息
                        $("#serialnumber_").html(billlist[i].serialnumber);
                        $("#issuetime_").html(billlist[i].issuetime);
                        $("#billexpecteddelivertime_").html(billlist[i].billexpecteddelivertime);
                        $("#remark_").html(billlist[i].remark);
                        $("#distributorname_").html(data[j].distributorname);
                        $("#mobilephone_").html(data[j].mobilephone);
                        $("#specialprice_").html("￥"+data[j].specialprice); 
                            //一个订单中具体有几条商品    
                            //优惠的金额
                            yh_menoy=parseInt(0);
                            sum_menoy=parseInt(0);         
                        for (var z = 0; z < billlist[i].details.length; z++)
                        {

                         var parent_div=$(".orderbaseinfo");
                         var child_div='<div class="confirmorderlayout">';
                         child_div+='<div  class="thumbimg">';
                         child_div+='<a  class="" title="" target="_blank"> <img src="../../image/shop/p7.png"></a>';           
                         child_div+='</div>';
                         child_div+='<div  class="desc">';
                         child_div+='<div class="order-des">';

                         //判断临  或 正 
                         if(billlist[i].details[z].itemtype==0){
                          child_div+='<i class="title"> '+billlist[i].details[z].itemobj.itemname+'</i>' 
                         }else{
                          child_div+='<i class="title2"> '+billlist[i].details[z].itemobj.itemname+'</i>' 
                         }

                         child_div+='<span class="ui-number">'+billlist[i].details[z].itemobj.specification+'</span>'
                         child_div+='</div>'                            
                         child_div+='</div>'
                         child_div+='<div class="rightside">'
                         child_div+='<p>￥'+billlist[i].details[z].itemunitcost+'<p>'
                         child_div+='<p>x '+billlist[i].details[z].qualitycount+' <p>'
                         child_div+='</div>'
                         child_div+='<div class="otherinfo">'
                           //判断分销商有没有活动
                         if (data[j].itemkind!=undefined) 
                          {
                              child_div+='<div class="discound"><span class="pic2">'+data[j].itemkind+'</span> <span>7.5折</span></div>'
                              child_div+= '<div class="remark"><span>赠品：</span>汤臣倍健蛋白粉 <span>150g</span> <span class="sidenum">x 2</span></div>'
                          }
                         
                        child_div+='<div class="bbs"><span>留言：</span>'+billlist[i].details[z].remark+'</div>';
                        child_div+='</div>'
                        child_div+='</div>'

                       parent_div.append(child_div);


                          //计算金额
                          var yuanshijia=billlist[i].details[z].itemoriginalcost;
                          var xianjia=billlist[i].details[z].itemunitcost;
                          var count=billlist[i].details[z].qualitycount;
                          //(商品原价-优惠价）*数量
                          yh_menoy1=(parseInt(yuanshijia)-parseInt(xianjia))*parseInt(count);
                          yh_menoy=yh_menoy+yh_menoy1;
                          //总的商品价格
                          sum_menoy1=parseInt(xianjia)*parseInt(count);
                          sum_menoy=sum_menoy+sum_menoy1;
                          //alert(sum_menoy);

                          //判断是否是赠品
                          //alert(billlist[i].details[z].billid_class)
                          if(billlist[i].details[z].billid_class=='tblbillgift')
                          {
                             alert(billlist[i].details[z].billid_class)
                          }
                          //判断是否是赠品


                        }

                        $("#youhui").html("￥"+yh_menoy);
                        $("#summenoy").html("￥"+sum_menoy);
                        
                    }// if  过滤订单列表

                }  //for循环遍历订单

            }//判断分销商
              
          } //遍历data数据

       }//ajax的success方法结束

   });  //ajax结束

  }); //document结束

</script>

</head>

<body >

<div class="container">
 <!-- nav-header start-->
<div class="nav-header">
<i><a href="#"><img src="../../image/shop/icon_close.png" alt=""></a></i>确认订单<em><a href="#"><img src="../../image/shop/icon_more.png" alt=""></a></em>
</div>
<!-- nav-header end-->
    <form id="R_cartForm" method="post" target="_self">
        <input type="hidden" name="tpId" value="725677994">
        <div id="R_Main">
            <div class="order-list">
                <div class="grid-shop" id="" >
                        <!-- orderbaseinfo start -->
                        <div class="orderbaseinfo">
                        <div class="orderup"></div>
                        <p><span>订单号：</span><span id="serialnumber_"></span></p>
                        <p><span>下单时间：</span><span id="issuetime_"></span></p>
                        <p><span>期望配送时间：</span><span id="billexpecteddelivertime_"></span></p>
                        <p><span>订单备注：</span><span id="remark_"></span></p>
                        <p><span>分销商名称：</span><span id="distributorname_"></span></p>
                         <p><span>联系方式：</span><span id="mobilephone_"></span></p>
                         <div class="orderdown"></div>
                        </div> 
                         <!-- orderbaseinfo end -->
                        
                        
                        
                          <!-- total info start -->
                         <div class="confirmorderlayout">        
                           <!-- total info 1  -->
                         <div class="otherinfo">
                           <div class="sub1">满赠</div>
                           <div class="sub2">
                          
                           <div class="remark">汤臣倍健蛋白粉 <span>150g</span> </div>
                     
                           <div class="remark">汤臣倍健康蛋白粉蛋白粉 <span>150g</span> </div>
                           
                             </div>
                             <div class="sub3">
                                <p>x 2</p>
                                <p>x 2</p>
                             </div>
                             
                          </div>
                          
                          
                          <div class="alldisplaybtn">展开全部 <img src="../../image/shop/arrow_down2.png" width="25" height="22"></div>
                          
                          
                            <!-- result info  -->
                         <div class="resultinfo">
                          <div class="remark">商品促销优惠金额  <span class="sidenum" id="youhui">￥100.00</span></div>
                         </div>
                         
                         <div class="resultinfo">
                          <div class="remark">赠品金额  <span class="sidenum">￥100.00</span></div>
                         </div>
                         
                         <div class="resultinfo">
                          <div class="remark">  <span class="boldfontcss">商品应付金额 </span> <span class="sidenum focusfontcss" id="summenoy">￥200.00</span></div>
                         </div>
                         
                         
                         <div class="resultinfo">
                          <div class="remark "><span class="boldfontcss">微信下单专享</span>  <span class="sidenum focusfontcss" id="specialprice_">-￥11.00</span></div>
                         </div>
                         
                         
                          <div class="resultinfo">
                          <div class="remark"><span class="boldfontcss">满减（满100减10元；满500减50元）</span>  <span class="sidenum focusfontcss">-￥11.00</span></div>
                         </div>
                         
                         </div>
                        <!-- total info end -->
                        
                        
                </div>
            </div>
            
         
            
            
            <!-- footer start -->
                        <div class="bottomlayout">
                        <div  class="bottompanel">
                       
                          
                       
                          
                          <!-- orderlayout 3 description -->
                          <div  class="totalinfo">
                            <div class="totalsum">
                                          <i class="sum"> 合计：￥50元</i> 
                                            <i class="proprice">已优惠金额：￥139.00  </i> 
                                            
                                      </div>
                            
                          </div>
                          </div>
                          
                         <!--  <div class="bottomsubmit">
                          <input type="button" data-evt="buy-cart-m/biz/go:submit" class="" >去提交(<span class="">20</span>)</input>
                          
                          </div> -->
                        </div>
                        <!-- footer end -->
            
            
        </div>
    </form>
</div>

<div style="display: none">
    <script src="../../js/shopcart/jquery-1.11.3.js"></script>
    <script src="../../js/shopcart/confirm.js"></script>
    <script src="../../js/shopcart/shop_cart.js"></script>
</div>

</body>
</html>