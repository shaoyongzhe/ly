<!DOCTYPE html>
<html >
<head>
    <title>确认订单</title>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta name="aplus-terminal" content="1">
    <link rel="stylesheet" href="css/shopcart.css"/>
    <link href="css/common.css" rel="stylesheet" type="text/css">
    <link href="css/master.css" rel="stylesheet" type="text/css">
    
    <link href="css/scroll/mobiscroll.custom-2.6.2.min.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="js/scroll/jquery.min.js"></script>
    <script type="text/javascript" src="js/retailerid.js"></script>
    <script type="text/javascript" src="js/scroll/mobiscroll.custom-2.6.2.min.js"></script>
<script>
    
     //接受从购物车页面传递过来的商品json对象
     function getParam() 
        {
	       	var urlInfo = window.location.href; //获取当前页面的url  
	        var intLen = urlInfo.length; //获取url的长度  
	        var offset = urlInfo.indexOf("?"); //设置参数字符串开始的位置  
	        var strKeyValue = urlInfo.substr(offset, intLen); //取出参数字符串 这里会获得类似“id=1”这样的字符串  
	        var arrParam = strKeyValue.split("="); //对获得的参数字符串按照“=”进行分割
	        var strParamValue = arrParam[1]; //得到参数值 
	        var distributor_id = arrParam[2]; //得到参数值 
	        var a = decodeURI(strParamValue);
	        /*var item_json=JSON.parse(a);*/
	        return a;
	   	}
        
        //获得分销商的id
        function getParam1() 
        {
	       	var urlInfo = window.location.href; //获取当前页面的url  
	        var intLen = urlInfo.length; //获取url的长度  
	        var offset = urlInfo.indexOf("?"); //设置参数字符串开始的位置  
	        var strKeyValue = urlInfo.substr(offset, intLen); //取出参数字符串 这里会获得类似“id=1”这样的字符串  
	        var arrParam = strKeyValue.split("="); //对获得的参数字符串按照“=”进行分割
	        var id = arrParam[3]; //得到参数值 
	        return id;
	   	}
    
     $(document).ready(function()
     {

        /*var href_=window.location.href;
        var distributor_id=top.window.parent.distributor_id;*/
        var distributor_id=getParam1();  //获取分销商的id
        var itemdata;
        
        //获取购物车里的商品
        $.get("/webapi/account/login/test-2-135-1",{},function(){},false);
        $.ajax({ 
            url:"/webapi/distributor/"+getRetailerid()+"/shoppingcart/"+distributor_id+"?isvalid=0",
            async:true,
            cache:false,
            type:"get",
            dataType:"json",
            error:function(){alert("网络出错")},
            success:function(data)
            { 
              	//判断出在购物车中被选中的商品  传递过来的是一个json对象
              	//遍历购物车内的商品，把选中的商品筛选出来
              	var a_json=getParam();   //得到从购物车传递过来的json数组
                var item_json=JSON.parse(a_json);  //把string转成json对象  获取从购物车页面传递的选中的商品对象集合
              	itemdata=data;
              	
              	for (var j=0;j<item_json.length;j++)  //遍历从购物车选中的商品传递过来的json数组
              	{
              		//alert(item_json.length)
	              	for(var i=0;i<data.length;i++)  //遍历购物车里面的商品
            	    {
            	    	//alert(data.length)
            	    	//选出购物车中  选中的商品
          				if( (data[i].itemguid==item_json[j].itemid) && (data[i].activityitem_id==item_json[j].activityitem_id)  && (data[i].isyucun==item_json[j].isyucun) )
              			{
	                   	    var  shoppingcart=data[i];    
	                   	    
                 			//【1】：有活动时  
							if(shoppingcart.activityitem_id.length>0)           
							{
								//alert(data[i].itemguid)
								  //【1.1】 上架商品
								  if(shoppingcart.hasOwnProperty("salestop")==false)
								  {
								  	 //alert("有活动上架")
									 if(shoppingcart.itemkind=='折扣')
									 {
									 	 var parent_div=$(".grid-shop-hd");
                                           var child_div='<div class="confirmorderlayout">';
                                           child_div+='<div  class="thumbimg">';
                                           child_div+='<a  class="" title="" target="_blank"> <img src="'+shoppingcart.itemimage+'"></a>';           
                                           child_div+='</div>';
                                           child_div+='<div  class="desc">';
                                           child_div+='<div class="order-des">';
                                           if(shoppingcart.itemquality==0)
                                           {
                                           		 child_div+='<i class="title"> '+shoppingcart.itemname+'</i>'
                                           }
                                           else
                                           {
                                           		child_div+='<i class="title2"> '+shoppingcart.itemname+'</i>'
                                           }
                                           child_div+='<span class="ui-number">'+shoppingcart.specification+'</span>'
                                           child_div+='</div>'                            
                                           child_div+='</div>'
                                           child_div+='<div class="rightside">'
                                           child_div+='<p>￥'+shoppingcart.itemunitcost+'<p>'
                                           child_div+='<p>x '+shoppingcart.itemcount +'<p>'
                                           child_div+='</div>'
                                           child_div+='<div class="otherinfo">'
                                           child_div+='<div class="discound"><span class="pic2">'+shoppingcart.itemkind+'</span> <span>7.5折</span></div>'
                                           //child_div+='<div class="remark"><span>赠品：</span>汤臣倍健蛋白粉 <span>150g</span> <span class="sidenum">x 2</span></div>';
                                           child_div+='<div class="bbs"><span>留言：</span>'+shoppingcart.remark+'</div>'
                                           child_div+='</div>'
                                           child_div+='</div>'
                                           parent_div.append(child_div);
									 }
									 if(shoppingcart.itemkind=='买赠')
									 {
									 	var parent_div=$(".grid-shop-hd");
                                           var child_div='<div class="confirmorderlayout">';
                                           child_div+='<div  class="thumbimg">';
                                           child_div+='<a  class="" title="" target="_blank"> <img src="'+shoppingcart.itemimage+'"></a>';           
                                           child_div+='</div>';
                                           child_div+='<div  class="desc">';
                                           child_div+='<div class="order-des">';
                                           if(shoppingcart.itemquality==0)
                                           {
                                           		 child_div+='<i class="title"> '+shoppingcart.itemname+'</i>'
                                           }
                                           else
                                           {
                                           		child_div+='<i class="title2"> '+shoppingcart.itemname+'</i>'
                                           }
                                          
                                           child_div+='<span class="ui-number">'+shoppingcart.specification+'</span>'
                                           child_div+='</div>'                            
                                           child_div+='</div>'
                                           child_div+='<div class="rightside">'
                                           child_div+='<p>￥'+shoppingcart.price+'<p>'
                                           child_div+='<p>x '+shoppingcart.itemcount +'<p>'
                                           child_div+='</div>'
                                           child_div+='<div class="otherinfo">'
                                           child_div+='<div class="discound"><span class="pic2">'+shoppingcart.itemkind+'</span> </div>'
                                           child_div+='<div class="remark"><span>赠品：</span>'+shoppingcart.giftitemobj.itemname+' <span>150g</span> <span class="sidenum">x '+shoppingcart.giftcount+'</span></div>';
                                           child_div+='<div class="bbs"><span>留言：</span>'+shoppingcart.remark+'</div>'
                                           child_div+='</div>'
                                           child_div+='</div>'
                                           parent_div.append(child_div);
									 }
									if(shoppingcart.itemkind=='有礼')
									 {
									 	var parent_div=$(".grid-shop-hd");
                                           var child_div='<div class="confirmorderlayout">';
                                           child_div+='<div  class="thumbimg">';
                                           child_div+='<a  class="" title="" target="_blank"> <img src="'+shoppingcart.itemimage+'"></a>';           
                                           child_div+='</div>';
                                           child_div+='<div  class="desc">';
                                           child_div+='<div class="order-des">';
                                           if(shoppingcart.itemquality==0)
                                           {
                                           		 child_div+='<i class="title"> '+shoppingcart.itemname+'</i>'
                                           }
                                           else
                                           {
                                           		child_div+='<i class="title2"> '+shoppingcart.itemname+'</i>'
                                           }
                                           child_div+='<span class="ui-number">'+shoppingcart.specification+'</span>'
                                           child_div+='</div>'                            
                                           child_div+='</div>'
                                           child_div+='<div class="rightside">'
                                           child_div+='<p>￥'+shoppingcart.price+'<p>'
                                           child_div+='<p>x '+shoppingcart.itemcount +'<p>'
                                           child_div+='</div>'
                                           child_div+='<div class="otherinfo">'
                                           child_div+='<div class="discound"><span class="pic2">'+shoppingcart.itemkind+'</span> </div>'
                                           child_div+='<div class="remark"><span>赠品：</span>'+shoppingcart.giftitemobj.itemname+' <span>150g</span> <span class="sidenum">x 2</span></div>';
                                           child_div+='<div class="bbs"><span>留言：</span>'+shoppingcart.remark+'</div>'
                                           child_div+='</div>'
                                           child_div+='</div>'
                                           parent_div.append(child_div); 
									 }
									 if(shoppingcart.itemkind=='降价')
									 {
									 	var parent_div=$(".grid-shop-hd");
                                           var child_div='<div class="confirmorderlayout">';
                                           child_div+='<div  class="thumbimg">';
                                           child_div+='<a  class="" title="" target="_blank"> <img src="'+shoppingcart.itemimage+'"></a>';           
                                           child_div+='</div>';
                                           child_div+='<div  class="desc">';
                                           child_div+='<div class="order-des">';
                                           if(shoppingcart.itemquality==0)
                                           {
                                           		 child_div+='<i class="title"> '+shoppingcart.itemname+'</i>'
                                           }
                                           else
                                           {
                                           		child_div+='<i class="title2"> '+shoppingcart.itemname+'</i>'
                                           }
                                           child_div+='<span class="ui-number">'+shoppingcart.specification+'</span>'
                                           child_div+='</div>'                            
                                           child_div+='</div>'
                                           child_div+='<div class="rightside">'
                                           child_div+='<p>￥'+shoppingcart.discountprice+'<p>'
                                           child_div+='<p>x '+shoppingcart.itemcount +'<p>'
                                           child_div+='</div>'
                                           child_div+='<div class="otherinfo">'
                                           child_div+='<div class="discound"><span class="pic2">'+shoppingcart.itemkind+'</span> <span>'+shoppingcart.discount+'折</span></div>'
                                           //child_div+='<div class="remark"><span>赠品：</span>汤臣倍健蛋白粉 <span>150g</span> <span class="sidenum">x '+shoppingcart.giftcount+'</span></div>';
                                           child_div+='<div class="bbs"><span>留言：</span>'+shoppingcart.remark+'</div>'
                                           child_div+='</div>'
                                           child_div+='</div>'
                                           parent_div.append(child_div);
									 }
									  
								   }
			
						    }//【1】：有活动时 结束
							
							
							//【2】：无活动 
							if(shoppingcart.activityitem_id.length==0)    
							{
							    //【2.0】 上架商品
							  	if(shoppingcart.salestop==0)  
							  	{
							  		alert("无活动 上架 ")
							  		var parent_div=$(".grid-shop-hd");
		                               var child_div='<div class="confirmorderlayout">';
		                               child_div+='<div  class="thumbimg">';
		                               child_div+='<a  class="" title="" target="_blank"> <img src="'+shoppingcart.itemslist[0].itemimage+'"></a>';           
		                               child_div+='</div>';
		                               child_div+='<div  class="desc">';
		                               child_div+='<div class="order-des">';
		                               child_div+='<i class="title"> '+shoppingcart.itemslist[0].itemname+'</i>'
		                               child_div+='<span class="ui-number">'+shoppingcart.itemslist[0].specification+'</span>'
		                               child_div+='</div>'                            
		                               child_div+='</div>'
		                               child_div+='<div class="rightside">'
		                               child_div+='<p>￥'+shoppingcart.price+'<p>'
		                               child_div+='<p>x '+shoppingcart.itemcount +'<p>'
		                               child_div+='</div>'
		                               child_div+='<div class="otherinfo">'
		                               //child_div+='<div class="discound"><span class="pic2">'+shoppingcart.itemkind+'</span> <span>7.5折</span></div>'
		                               //child_div+='<div class="remark"><span>赠品：</span>汤臣倍健蛋白粉 <span>150g</span> <span class="sidenum">x 2</span></div>';
		                               child_div+='<div class="bbs"><span>留言：</span>'+shoppingcart.remark+'</div>'
		                               child_div+='</div>'
		                               child_div+='</div>'
		                               parent_div.append(child_div);
							   	}
	
							} //【2】：无活动  结束
							  
							  
							//【3】是预存货
							if(shoppingcart.isyucun==1)   
							{
							     //【3.0】 :上架
								 if(shoppingcart.salestop==0)
								 {
								 	//alert("预存货上架")
									 var parent_div=$(".grid-shop-hd");
		                               var child_div='<div class="confirmorderlayout">';
		                               child_div+='<div  class="thumbimg">';
		                               child_div+='<a  class="" title="" target="_blank"> <img src="'+shoppingcart.itemimage+'"></a>';           
		                               child_div+='</div>';
		                               child_div+='<div  class="desc">';
		                               child_div+='<div class="order-des">';
		                               child_div+='<i class="title"> '+shoppingcart.itemname+'</i>'
		                               child_div+='<span class="ui-number">'+shoppingcart.specification+'</span>'
		                               child_div+='</div>'                            
		                               child_div+='</div>'
		                               child_div+='<div class="rightside">'
		                               child_div+='<p>￥'+shoppingcart.itemunitcost+'<p>'
		                               child_div+='<p>x '+shoppingcart.itemcount +'<p>'
		                               child_div+='</div>'
		                               child_div+='<div class="otherinfo">'
		                               child_div+='<div class="discound"><span class="pic2">'+shoppingcart.itemkind+'</span> <span>7.5折</span></div>'
		                               //child_div+='<div class="remark"><span>赠品：</span>汤臣倍健蛋白粉 <span>150g</span> <span class="sidenum">x 2</span></div>';
		                               child_div+='<div class="bbs"><span>留言：</span>'+shoppingcart.remark+'</div>'
		                               child_div+='</div>'
		                               child_div+='</div>'
		                               parent_div.append(child_div); 	
								 } 
								  
						   }//【3】是预存货 结束
								   
					              				
	              	    } //选出购物车中  选中的商品  结束
              		}  //遍历购物车里面的商品 结束
                }  //遍历从购物车选中的商品传递过来的json数组  结束
              	//判断出在购物车中被选中的商品  传递过来的是一个json对象   结束
              	
             }  // success 获取购物车里的商品结束

         }); //ajax结束


        //点击提交购物车
        $(".bottomsubmit").click(function () {
        	  
             var da=$("#txtDate").val();  //获取用户的送货时间
             for(var i=0;i<itemdata.length;i++)
             {
             	var distributor_id=getParam1();  //获取分销商的id
                var a_json=getParam();
                var item_json=JSON.parse(a_json);  //把string转成json对象  获取从购物车页面传递的选中的商品对象集合
	        	/*alert("您要传递的参数值是" + item_json[0].itemid);
	        	alert("您要传递的参数值是" + item_json[0].isyucun);
	        	alert("您要传递的参数值是" + item_json[0].activityitem_id);*/
	        	//alert(distributor_id)
	        	//alert(da)
                //alert(item_json)
                
                $.ajax({
                      url:"/webapi/distributor/"+getRetailerid()+"/orderform",
                    type:"post",              
                    async:false,
                    dataType:"json",
                    data:{
                          distributor_id:distributor_id,
                          remark:null,
                          deliverdate:da,
                          items:item_json
                        },
                    success:function(data)
                        {
                          alert("成功")
                         // alert(data)
                        },
                    error:function(XMLHttpRequest_, textStatus_, errorThrown_)
                       {
                         alert("提交失败")
                       }
                  }); //ajax结束
                break;
              }  //for循环结束
               
           });//点击提交购物车 提交事件结束


     });//document结束
</script>
    
   
    
</head>

<body >

<div class="container">
    <form id="R_cartForm" method="post" target="_self">
        <input type="hidden" name="tpId" value="725677994">
        <div id="R_Main">
            <div class="order-list">
                <div class="grid-shop" id="" >
                
                        <div class="grid-shop-hd">
                        
                            <div class="shoptotal">
                               
                             
                                    <p class="title">送货时间</p>
                                
                                <div class="totalright">
                                <p class="numstyle">
                                <label for="txtDate"></label>
         <input type="text"   id="txtDate" name="birthday"  value="2016-12-12" style="width:100px;"/>
 </div></p>
                                    
                                </div>
                            </div>
                            
                        </div>
                        

                        
                          <!-- total info start -->
                         <div class="confirmorderlayout">        
                           <!-- total info 1  -->
                         <div class="otherinfo">
                           <div class="sub1">满赠</div>
                           <div class="sub2">
                          
                           <div class="remark">汤臣倍健蛋白粉 <span>150g</span> </div>
                     
                           <div class="remark">汤臣倍健康蛋白粉蛋白粉 <span>150g</span> </div>
                           
                             </div>
                             <div class="sub3">
                                <p>x 2</p>
                                <p>x 2</p>
                             </div>
                             
                          </div>
                            <!-- result info  -->
                         <div class="resultinfo">
                          <div class="remark">商品促销优惠金额  <span class="sidenum">￥100.00</span></div>
                         </div>
                         
                         <div class="resultinfo">
                          <div class="remark">赠品金额  <span class="sidenum">￥100.00</span></div>
                         </div>
                         
                         <div class="resultinfo">
                          <div class="remark">  <span class="boldfontcss">商品应付金额 </span> <span class="sidenum focusfontcss">￥200.00</span></div>
                         </div>
                         
                         
                         <div class="resultinfo">
                          <div class="remark "><span class="boldfontcss">微信下单专享</span>  <span class="sidenum focusfontcss">-￥11.00</span></div>
                         </div>
                         
                         
                          <div class="resultinfo">
                          <div class="remark"><span class="boldfontcss">满减（满100减10元；满500减50元）</span>  <span class="sidenum focusfontcss">-￥11.00</span></div>
                         </div>
                         
                         </div>
                        <!-- total info end -->
                        
                        
                </div>
            </div>
            
            
            <!-- footer start -->
                        <div class="bottomlayout">
                        <div  class="bottompanel">
                          
                          <!-- orderlayout 3 description -->
                          <div  class="totalinfo">
                            <div class="totalsum">
                                          <i class="sum"> 合计：￥0元</i> 
                                            <i class="proprice">已优惠金额：￥0.00  </i>                                             
                                      </div>
                            
                          </div>
                          </div>
                          
                          <div class="bottomsubmit">
                          <input type="button" data-evt="buy-cart-m/biz/go:submit" class="submit_" >去提交(<span class="">0</span>)</input>
                          
                          </div>
                        </div>
                        <!-- footer end -->
            
        </div>
    </form>
</div>

<div style="display: none">
   
    <script src="js/shopcart/confirm.js"></script>
    <script src="js/shopcart/shop_cart.js"></script>
</div>
 <script>  
$(function () {  
 var opt = {  
        theme: "android-ics light", 
        display: 'modal', //显示方式  
        lang: "zh",  
        setText: '确定', //确认按钮名称
        cancelText: "取消",  
        dateFormat: 'yyyy-mm-dd', //返回结果格式化为年月格式  
        dateOrder: 'yyyymmdd', //面板中日期排列格式
        onBeforeShow: function (inst) {
		//	console.info( inst.settings.wheels);
          }, 
        headerText: function (valueText) { //自定义弹出框头部格式  
        //	console.info(valueText);
            array = valueText.split('-'); 
            //var i=array[0] + "年" + array[1] + "月" + array[2] + "日";  
            //alert(i)
            return array[0] + "年" + array[1] + "月" + array[2] + "日";  

        }  
    };

  $("#txtDate").mobiscroll().date(opt); 

});

 
</script>  
</body>
</html>