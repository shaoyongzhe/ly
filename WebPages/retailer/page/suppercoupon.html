<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no" />
		<title>商家超惠券</title>
		<link rel="stylesheet" href="/retailer/css/cui.css" />
		<link rel="stylesheet" href="/retailer/css/lib.css" />
		<link rel="stylesheet" href="/retailer/css/slick.css" />
		<link rel="stylesheet" href="/retailer/css/style.css" />
		<link rel="stylesheet" href="/retailer/css/retailerstyle.css" />

		<link rel="stylesheet" href="/retailer/css/weixintips.css" />
		<link href="../css/dropload.css" rel="stylesheet" />
		<!-- 0 -->
		<link rel="stylesheet" type="text/css" href="/retailer/css/reset.css" />
		<link rel="stylesheet" type="text/css" href="/retailer/css/swiper-3.4.1.min.css" />
		<link rel="stylesheet" type="text/css" href="/retailer/css/suppercoupon.css" />
		<!-- 1 -->
	</head>

	<body>
		<style>
			.sharestyle {
				position: fixed;
				left: 0;
				bottom: 50px;
				z-index: 99;
				width: 100%;
				height: 34px;
				line-height: 34px;
				color: #fff;
				text-align: center;
				background: rgba(0, 0, 0, 0.6);
			}
			
			.stateBj {
				background: rgba(51, 51, 51, .9) !important;
			}
		</style>
		<div class="listBox" id="list" style="margin-bottom: 34px !important;">
			<div v-show="isShow" style="display: none;">
				<!-- 超惠券列表 -->
				<div v-for="item in array">
					<dl class="clearfix" @click="toItems(item.activity_id)">
						<dt>
						<img :src="item.imgSrc"/>
						<span>{{item.state}}</span>
					</dt>
						<dd>
							<h3>
							{{item.title}}
						</h3>
							<p><img src="/retailer/image/user1.jpg" /><span>{{item.userNum}}</span></p>
							<p><img src="/retailer/image/time.jpg" /><span>{{item.beginTime}}</span><span> 至 </span><span>{{item.endTime}}</span></p>
						</dd>
					</dl>
					<div class="shangjia">
						<img src="/retailer/image/d_shang.jpg" />
						<span>
						{{item.company}}
					</span>
					</div>
					<!--</div>-->
					<p class="bg" v-if=item.flag></p>
					<div class="swiper-container" v-else>
						<div class="swiper-wrapper slideTop">
							<div class="swiper-slide slide1 slide" @click="toTopic(item.data.guid)">
								<a class="youzi1" href="javascript:;">{{item.data.msg}}</a>
								<span>{{item.data.butie}}万</span>
							</div>
							<div class="swiper-slide slide2 slide">
								<p>
									活动预算：<span>{{item.data.yusuan}}</span>元
								</p>
								<p>
									已 发 放：<span>{{item.data.fafang}}</span>元
								</p>
								<span>{{item.data.fanxian}}</span>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- share -->
			<div class="sharestyle " style="font-size:16px;">
				<a href="javascript:void(0);" style="color:#fff">
					推荐给好友
					<img style="width: 20px;vertical-align: middle;" src="../image/icon04.png" />
				</a>
			</div>
		</div>
		<footer>
			<div id="bottom-nav"></div>
		</footer>
		<div class="overlay"></div>

		<script type="text/javascript" src="/js/wx/md5.min.js"></script>
		<script type="text/javascript">
			document.writeln("<script type=\"text\/javascript\"");
			document.writeln("src=\"\/webapi\/retailer\/weixin\/jssdk/" + md5(window.location.href) + ".js\">");
			document.writeln("<\/script>");
		</script>
		<script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
		<script src="http://apps.bdimg.com/libs/jquery-lazyload/1.9.5/jquery.lazyload.min.js"></script>
		<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js" type="text/javascript"></script>
		<!-- 0 -->
		<script src="//cdn.bootcss.com/vue/2.1.10/vue.js"></script>
		<script src="/retailer/js/swiper-3.4.1.jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="/retailer/js/adaptive.js" type="text/javascript" charset="utf-8"></script>
		<!-- 1 -->
		<script type="text/javascript" src="/js/jquery/toastr.min.js"></script>
		<script type="text/javascript" src="/js/jquery/utitlity.js"></script>
		<script type="text/javascript" src="/js/wx/configinit.js"></script>
		<script type="text/javascript" src="/js/wx/share.js"></script>
		<script type="text/javascript">
			var share_category = "retailer";
		</script>
		<script src="/retailer/js/lib/common.js"></script>
		<script src="/js/jquery/dropload.min.js"></script>
		<script src="/retailer/js/common-buttom-nav.js"></script>

		<script type="text/javascript">
			var pageIndex = 1;
			var isInit = true;
			$(function() {
				$('.sharestyle').click(function(event) {
					$('.overlay').fadeIn(200);
				});
				$('.overlay').click(function(event) {
					/* Act on the event */
					$(this).fadeOut(200);
				});

			});

			var vm = new Vue({
				el: ".listBox",
				data: {
					array: [],
					isShow: false
				},
				mounted: function() {
					//					this.nameSearch();
					loaddata(null);
				},
				methods: {
//					nameSearch: function() {
//						var _self = this;
//						$.ajax({
//							type: 'GET',
//							url: "/retailer/data/mdTickeList.json",
//							success: function(data) {
//								_self.items = data;
//								setTimeout(function() {
//									mySwiper()
//								}, 500)
//							}
//						});
//					},
					toItems: function(activityId) {
						location.href = "/retailer/page/suppercouponitems.html?activity_id=" + activityId;
					},
					toTopic: function(topicId) {
						location.href = "/retailer/page/participate.html?topicid=" + topicId;
					}
				}
			})

			function loaddata(dropme) {
				var listitem = "";
				var ajaxdata = { activitykind: "distributor_to_consumer", activitytype: "ticket", pageindex: pageIndex };
				// alert(wxjsconfig.sharekey)
				if(wxjsconfig.sharekey != null)
					ajaxdata[wxjsconfig.sharekey] = "_";
				$.ajax({
					type: 'GET',
					dataType: 'json',
//					data: ajaxdata,
//					url: '/webapi/retailer/weixin/activities',
					url: "/retailer/data/mdTickeList.json",
					beforeSend: function() { if(pageIndex == 1) { common.loading.show(); } },
					complete: function() { if(pageIndex == 1) { common.loading.hide(); } },
					success: function(json) {
						console.log(json)
						common.loading.hide();
						json = json || {}; /* 统一加这句话 */
						if(jQuery.isEmptyObject(json)) {
							dealdropme(dropme);
							return;
						}
						if(json.error) {
							toasterextend.showtips(json.error, "error");
							dealdropme(dropme);
							return;
						}
						if(json.user_notification) {
							if(pageIndex == 1) {
								$('#list').html("<div class=\"nohd\" style='margin-top:35%;'><img style='height:80%' src=\"/retailer/image/超惠券.png\" /><br/></div>");
							}
							toasterextend.showtips(json.user_notification, "info");
							dealdropme(dropme);
							return;
						}
						if(pageIndex == 1){
//							vm.array = json.data;
							vm.array = json;
							vm.isShow = true;
						}else {
//							$.each(json.data, function(i, v) {
							$.each(json, function(i, v) {
								vm.array.push(v);
								vm.isShow = true;
							});
						}
						setTimeout(function() {
							mySwiper();
						}, 500)
						// vm.$data.array.push(json.data)

						if(pageIndex == 1 && isInit && !json.error && !json.user_notification) {
							isInit = false;
							if($.isFunction(wxjsshare)) {
								wxjsshare(json.share || {});
							}
							$('#dropload').dropload({
								scrollArea: window,
								domDown: {
									domClass: 'dropload-down',
									domRefresh: '<div class="dropload-refresh">↑加载更多</div>',
									domLoad: '<div class="dropload-load"><span class="loading"></span>加载中...</div>',
									domNoData: '<div class="dropload-noData">暂无数据</div>'
								},
								loadDownFn: function(me) {
									pageIndex++;
									loaddata(me);
								}
							});
						}
						$("img.lazy").lazyload();
						if(dropme != null)
							dropme.resetload();

					},
					error: function(XMLHttpRequest, textStatus, errorThrown) {

						var errormsg = "访问异常";

						if(XMLHttpRequest.status != null && XMLHttpRequest.status != 200) {
							var json = JSON.parse(XMLHttpRequest.responseText);
							errormsg = JSON.parse(json.Message).error;
							if(errormsg == undefined || errormsg == '')
								errormsg = "Http error: " + XMLHttpRequest.statusText;
						}

						toasterextend.showtips(errormsg, "error");
						dealdropme(dropme);
					}
				});
			}
			/*
			 * 轮播
			 */
			function mySwiper() {
				var mySwiper = new Swiper('.swiper-container', {
					direction: 'vertical',
					speed: 400,
					autoplay: 1500,
					autoplayDisableOnInteraction: false,
					grabCursor: true,
					preventLinksPropagation: false,
					loop: true,
					observer: true, //修改swiper自己或子元素时，自动初始化swiper
					observeParents: true //修改swiper的父元素时，自动初始化swiper
				});
			}
		</script>

		<script src="/js/sdk/sdk.js"></script>
	</body>

</html>