<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>超惠活动详情</title>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no">


    <link rel="stylesheet" href="/retailer/css/cui.css" />
    <link rel="stylesheet" href="/retailer/css/lib.css" />
    <link rel="stylesheet" href="/retailer/css/slick.css" />
    <link rel="stylesheet" href="/retailer/css/style.css" />
    <link rel="stylesheet" href="/retailer/css/retailerstyle.css" />
    <link href="/retailer/css/weixintips.css" rel="stylesheet" />
    <script src="/js/guid-debug.js"></script>
    <script src="/js/juicer-min.js"></script>
    <script src="/js/jquery/1.11.3/jquery.js"></script>
    <script src="/retailer/js/common-buttom-nav-debug.js"></script>
    <script src="/js/jquery/toastr.min.js"></script>
    <script src="/retailer/js/lib/jquery-toastr-extend.js"></script>
    <script type="text/javascript">document.writeln("<script type=\"text\/javascript\""); document.writeln("src=\"\/webapi\/retailer\/weixin\/jssdk?t=" + new Date().getTime() + "\">"); document.writeln("<\/script>");	</script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js" type="text/javascript"></script>
    <script type="text/javascript" src="/js/wx/weixinconfiginit-debug.js"></script>
    <script type="text/javascript">var share_category = "retailer";</script>
    <script src="/js/wx/weixinshare-debug.js"></script>
    <script id="tpl" type="text/template">
        <div class="wp2">
            <div class="Inside" style="margin-top:0">
                <div class="pic">
                    <img src="${data[0].posterpic}" alt="">
                    <span>${data[0].time_to_end_text}</span>
                </div>
                <div class="tit" style="border-bottom:none !important">
                    <h3 style="overflow:hidden;white-space:nowrap;text-overflow:ellipsis;width:100%;">${data[0].activitytitle}</h3>
                    <div class="time">
                        ${data[0].begintime}至${data[0].endtime}
                    </div>
                </div>
                {@if data[0].changes.length >0}
                <div class="txt-sm">
                    <h4><em>更正说明</em></h4>
                    {@each data[0].changes as change}
                    <p class="c-red"> ${change.correctdescription}</p>
                    {@/each}                    
                </div>
                {@/if}
                {@if data[0].customerrequest.length >0}
                <div class="txt-sm">
                    <h3><em>门店要求</em></h3>
                    <p>${data[0].customerrequest}</p>
                </div>
                {@/if}
            </div>
        </div>
        <ul class="ul-list">
            {@each data[0].items as item}
            <li>
                <div class="pic">
                    <img src="${item.itempic}" alt="">
                    <span>${item.activitykind}</span>
                </div>
                <div class="txt">
                    <h3 style="overflow:hidden;white-space:nowrap;text-overflow:ellipsis;width:100%">
                        ${item.activitytitle}
                    </h3>
                    {@if item.activitykind ==="有礼"}
                    <div class="pre">
                        <em class="l">赠</em>
                        <div class="txt-r">
                            <p>${item.giftname}</p>
                        </div>
                    </div>
                    {@else if item.activitykind === "降价"}
                    <div class="t-sm">
                        <span class="s2">折扣 ${item.discount}</span>
                    </div>
                    <div class="jg">
                        <strong>￥${item.discountprice}</strong>
                        <del>￥${item.originalprice}</del>
                    </div>
                    {@else if item.activitykind === "赠品" || item.activitykind === "买赠"}
                    <div class="t-sm">
                        <span class="s2">
                            买${item.buycount}赠${item.giftcount}
                        </span>
                    </div>
                    <div class="jg">
                        <strong>￥${item.unitprice}</strong>
                    </div>
                    {@else if item.activitykind === "套餐"}
                    <div class="t-sm">
                        <span class="s2">已节省 ${item.sparevalue}</span>
                    </div>
                    <div class="jg">
                        <strong>￥${item.discountprice}</strong>
                        <del>￥${item.originalprice}</del>
                    </div>
                    {@/if}
                </div>

                <div class="c"></div>
                <div class="note">
                    ${item.ruledesc}
                </div>
            </li>
            {@/each}
        </ul>
        {@if data[0].description.length >0}
        <div class="h"></div>
        <div class="wp2">
            <div class="txt-sm">
                <h3><em>补充信息</em></h3>
                <p>${data[0].description}</p>
            </div>
        </div>
        {@/if}
        <!--<div class="wei-ma">
            <div class="bor">
                <img src="TODO:二维码，需提供活动二维码URL" alt="">
                <p>长按上方二维码图片</p>
                <p>关注超惠卖</p>
            </div>
        </div>-->
    </script>

    <script type="text/javascript">

        $(function () {
            var activity_id = "";
            var urlinfo = window.location.href; //获取当前页面的url
            var len = urlinfo.length;//获取url的长度
            var offset = urlinfo.indexOf("?");//设置参数字符串开始的位置
            if (offset != -1) {
                var newsidinfo = urlinfo.substr(offset, len)//取出参数字符串 这里会获得类似“id=1”这样的字符串
                var newsids = newsidinfo.split("=");//对获得的参数字符串按照“=”进行分割
                activity_id = newsids[1];//得到参数值
            }
            if (activity_id != "") {
                $("#hreffans").attr("href", $("#hreffans").attr("href") + "?activity_id=" + activity_id);
            }

            var ajaxdata = { activity_id: activity_id };
            if (wxjsconfig.sharekey != null)
                ajaxdata[wxjsconfig.sharekey] = "_";

            $.ajax({
                type: 'GET',
                dataType: 'json',
                data: ajaxdata,
                beforeSend: function () { $(".pin-spinner").show(); },
                complete: function () { $(".pin-spinner").hide(); },
                url: '/webapi/retailer/weixin/GetAssignActivityDetails',
                success: function (json) {
                    $(".pin-spinner").hide();//隐藏转圈动画

                    json = json || {};   /* 统一加这句话 */
                    if (json.error) {
                        toasterextend.showtips(json.error, "error");
                        return;
                    }
                    if (json.user_notification != undefined) {
                        toasterextend.showtips(json.user_notification, "info");
                        return;
                    }

                    if ($.isFunction(wxjsshare)) {
                        wxjsshare(json.share || {});
                        }
                    var tpl = document.getElementById('tpl').innerHTML;
                    var html = juicer(tpl, json);
                    $("#list").html(html);

                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    $(".pin-spinner").hide();//隐藏转圈动画

                    var errormsg = "访问异常";

                    if (XMLHttpRequest.status != null && XMLHttpRequest.status != 200) {
                        var json = JSON.parse(XMLHttpRequest.responseText);
                        errormsg = JSON.parse(json.Message).error;
                        if (errormsg == undefined || errormsg == '')
                            errormsg = "Http error: " + XMLHttpRequest.statusText;
                        }

                    toasterextend.showtips(errormsg, "error");
                        }
            });
        });

    </script>
    <style>
        .pin-spinner {
            display: none;
            width: 34px;
            height: 34px;
            position: fixed;
            margin-left: -17px;
            z-index: 999999999;
            left: 50%;
            top: 35%;
        }

        .pin-spinner-container1 > div, .pin-spinner-container2 > div, .pin-spinner-container3 > div {
            width: 10px;
            height: 10px;
            background-color: #457486;
            border-radius: 100%;
            position: absolute;
            -webkit-animation: bouncedelay 1.2s infinite ease-in-out;
            animation: bouncedelay 1.2s infinite ease-in-out;
            -webkit-animation-fill-mode: both;
            animation-fill-mode: both;
        }

        .pin-spinner .pin-spinner-container {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .pin-spinner-container2 {
            -webkit-transform: rotate(45deg);
            -ms-transform: rotate(45deg);
            transform: rotate(45deg);
        }

        .pin-spinner-container3 {
            -webkit-transform: rotate(90deg);
            -ms-transform: rotate(90deg);
            transform: rotate(90deg);
        }

        .pin-spinner-circle1 {
            top: 0;
            left: 0;
        }

        .pin-spinner-circle2 {
            top: 0;
            right: 0;
        }

        .pin-spinner-circle3 {
            right: 0;
            bottom: 0;
        }

        .pin-spinner-circle4 {
            left: 0;
            bottom: 0;
        }

        .pin-spinner-container2 .pin-spinner-circle1 {
            -webkit-animation-delay: -1.1s;
            animation-delay: -1.1s;
        }

        .pin-spinner-container3 .pin-spinner-circle1 {
            -webkit-animation-delay: -1s;
            animation-delay: -1s;
        }

        .pin-spinner-container1 .pin-spinner-circle2 {
            -webkit-animation-delay: -.9s;
            animation-delay: -.9s;
        }

        .pin-spinner-container2 .pin-spinner-circle2 {
            -webkit-animation-delay: -.8s;
            animation-delay: -.8s;
        }

        .pin-spinner-container3 .pin-spinner-circle2 {
            -webkit-animation-delay: -.7s;
            animation-delay: -.7s;
        }

        .pin-spinner-container1 .pin-spinner-circle3 {
            -webkit-animation-delay: -.6s;
            animation-delay: -.6s;
        }

        .pin-spinner-container2 .pin-spinner-circle3 {
            -webkit-animation-delay: -.5s;
            animation-delay: -.5s;
        }

        .pin-spinner-container3 .pin-spinner-circle3 {
            -webkit-animation-delay: -.4s;
            animation-delay: -.4s;
        }

        .pin-spinner-container1 .pin-spinner-circle4 {
            -webkit-animation-delay: -.3s;
            animation-delay: -.3s;
        }

        .pin-spinner-container2 .pin-spinner-circle4 {
            -webkit-animation-delay: -.2s;
            animation-delay: -.2s;
        }

        .pin-spinner-container3 .pin-spinner-circle4 {
            -webkit-animation-delay: -.1s;
            animation-delay: -.1s;
        }

        @-webkit-keyframes bouncedelay {
            0%,80%,to {
                -webkit-transform: scale(0);
                transform: scale(0);
            }

            40% {
                -webkit-transform: scale(1);
                transform: scale(1);
            }
        }

        @keyframes bouncedelay {
            0%,80%,to {
                -webkit-transform: scale(0);
                transform: scale(0);
            }

            40% {
                -webkit-transform: scale(1);
                transform: scale(1);
            }
        }
    </style>
</head>
<body>
    <div class="pin-spinner" style="display:block;">
        <div class="pin-spinner-container pin-spinner-container1">
            <div class="pin-spinner-circle1"></div>
            <div class="pin-spinner-circle2"></div>
            <div class="pin-spinner-circle3"></div>
            <div class="pin-spinner-circle4"></div>
        </div>
        <div class="pin-spinner-container pin-spinner-container2">
            <div class="pin-spinner-circle1"></div>
            <div class="pin-spinner-circle2"></div>
            <div class="pin-spinner-circle3"></div>
            <div class="pin-spinner-circle4"></div>
        </div>
        <div class="pin-spinner-container pin-spinner-container3">
            <div class="pin-spinner-circle1"></div>
            <div class="pin-spinner-circle2"></div>
            <div class="pin-spinner-circle3"></div>
            <div class="pin-spinner-circle4"></div>
        </div>
    </div>
    <div id="bd">
        <div id="list">

        </div>

    </div>
    <div id="bottom-nav"></div>   

    <script type="text/javascript">

        //弹出垂直菜单
        $(".menu").click(function () {
            if ($(this).hasClass("cura")) {
                $(this).children(".new-sub").hide(); //当前菜单下的二级菜单隐藏
                $(".menu").removeClass("cura"); //同一级的菜单项
            } else {
                $(".menu").removeClass("cura"); //移除所有的样式
                $(this).addClass("cura"); //给当前菜单添加特定样式
                $(".menu").children(".new-sub").slideUp("fast"); //隐藏所有的二级菜单
                $(this).children(".new-sub").slideDown("fast"); //展示当前的二级菜单
            }
        });

    </script>

    <div class="overlay"></div>
</body>
