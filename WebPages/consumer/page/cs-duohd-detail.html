<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1 ,minimum-scale =1, maximum-scale =1, user-scalable = no" />
    <meta name="format-detection" content="telephone=no" />
    <title>活动分享</title>
    <link type="text/css" href="/consumer/css/style_media.css" rel="stylesheet" />
    <link type="text/css" href="/consumer/css/lib.css" rel="stylesheet" />
    <link type="text/css" href="/consumer/css/style1_media.css" rel="stylesheet" />
	<link type="text/css" href="/consumer/css/qrcode.css" rel="stylesheet" />	
	<script src="/js/jquery/1.11.3/jquery.js" type="text/javascript"></script>
    <script src="/consumer/js/lib/lib.js" type="text/javascript"></script>    
    
    <script src="/consumer/js/lib/weixintips.js"></script>   
    <script type="text/javascript" src="/consumer/js/lib/jquery-toastr-extend.js"></script>	
    <script type="text/javascript" src="/consumer/js/lib/common-debug.js"></script>	
	<script type="text/javascript" src="/js/guid-debug.js"></script>	
	<script type="text/javascript">document.writeln("<script type=\"text\/javascript\""); document.writeln("src=\"\/webapi\/consumer\/weixin\/jssdk?t=" + new Date().getTime() + "\">"); document.writeln("<\/script>");	</script>
	<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js" type="text/javascript"></script>	
	<script type="text/javascript" src="/js/wx/weixinconfiginit-debug.js"></script>	
	<script type="text/javascript" src="/js/wx/weixinshare-debug.js"></script>	
    <script type="text/javascript" src="/consumer/js/lib/weixinshare-qrcode-debug.js"></script>	
	<script src="/consumer/js/cs-danhd-detail.js"></script>
    <style>
        .pin-spinner {
            display: none;
            width: 34px;
            height: 34px;
            position: fixed;
            margin-left: -17px;
            z-index: 999999999;
            left: 50%;
            top: 35%;
        }

        .pin-spinner-container1 > div, .pin-spinner-container2 > div, .pin-spinner-container3 > div {
            width: 10px;
            height: 10px;
            background-color: #457486;
            border-radius: 100%;
            position: absolute;
            -webkit-animation: bouncedelay 1.2s infinite ease-in-out;
            animation: bouncedelay 1.2s infinite ease-in-out;
            -webkit-animation-fill-mode: both;
            animation-fill-mode: both;
        }

        .pin-spinner .pin-spinner-container {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .pin-spinner-container2 {
            -webkit-transform: rotate(45deg);
            -ms-transform: rotate(45deg);
            transform: rotate(45deg);
        }

        .pin-spinner-container3 {
            -webkit-transform: rotate(90deg);
            -ms-transform: rotate(90deg);
            transform: rotate(90deg);
        }

        .pin-spinner-circle1 {
            top: 0;
            left: 0;
        }

        .pin-spinner-circle2 {
            top: 0;
            right: 0;
        }

        .pin-spinner-circle3 {
            right: 0;
            bottom: 0;
        }

        .pin-spinner-circle4 {
            left: 0;
            bottom: 0;
        }

        .pin-spinner-container2 .pin-spinner-circle1 {
            -webkit-animation-delay: -1.1s;
            animation-delay: -1.1s;
        }

        .pin-spinner-container3 .pin-spinner-circle1 {
            -webkit-animation-delay: -1s;
            animation-delay: -1s;
        }

        .pin-spinner-container1 .pin-spinner-circle2 {
            -webkit-animation-delay: -.9s;
            animation-delay: -.9s;
        }

        .pin-spinner-container2 .pin-spinner-circle2 {
            -webkit-animation-delay: -.8s;
            animation-delay: -.8s;
        }

        .pin-spinner-container3 .pin-spinner-circle2 {
            -webkit-animation-delay: -.7s;
            animation-delay: -.7s;
        }

        .pin-spinner-container1 .pin-spinner-circle3 {
            -webkit-animation-delay: -.6s;
            animation-delay: -.6s;
        }

        .pin-spinner-container2 .pin-spinner-circle3 {
            -webkit-animation-delay: -.5s;
            animation-delay: -.5s;
        }

        .pin-spinner-container3 .pin-spinner-circle3 {
            -webkit-animation-delay: -.4s;
            animation-delay: -.4s;
        }

        .pin-spinner-container1 .pin-spinner-circle4 {
            -webkit-animation-delay: -.3s;
            animation-delay: -.3s;
        }

        .pin-spinner-container2 .pin-spinner-circle4 {
            -webkit-animation-delay: -.2s;
            animation-delay: -.2s;
        }

        .pin-spinner-container3 .pin-spinner-circle4 {
            -webkit-animation-delay: -.1s;
            animation-delay: -.1s;
        }

        @-webkit-keyframes bouncedelay {
            0%,80%,to {
                -webkit-transform: scale(0);
                transform: scale(0);
            }

            40% {
                -webkit-transform: scale(1);
                transform: scale(1);
            }
        }

        @keyframes bouncedelay {
            0%,80%,to {
                -webkit-transform: scale(0);
                transform: scale(0);
            }

            40% {
                -webkit-transform: scale(1);
                transform: scale(1);
            }
        }
    </style>
</head>
<body style="background:#fff;">
    <div class="pin-spinner" style="display:block;">
        <div class="pin-spinner-container pin-spinner-container1">
            <div class="pin-spinner-circle1"></div>
            <div class="pin-spinner-circle2"></div>
            <div class="pin-spinner-circle3"></div>
            <div class="pin-spinner-circle4"></div>
        </div>
        <div class="pin-spinner-container pin-spinner-container2">
            <div class="pin-spinner-circle1"></div>
            <div class="pin-spinner-circle2"></div>
            <div class="pin-spinner-circle3"></div>
            <div class="pin-spinner-circle4"></div>
        </div>
        <div class="pin-spinner-container pin-spinner-container3">
            <div class="pin-spinner-circle1"></div>
            <div class="pin-spinner-circle2"></div>
            <div class="pin-spinner-circle3"></div>
            <div class="pin-spinner-circle4"></div>
        </div>
    </div>
    <script type="text/javascript">
	
        $(function () {
            var $divWidth = $('.duohdbox').width();
            $('.duohdbox').css({ 'height': $divWidth * 3 / 4 });
            loaddata();
        })

        $(function () {
            pageType = 1;
            //$('.share').click(function () {
            //    $('.tip-w').fadeIn(1000).delay(3000).fadeOut(1000);
            //})

            $('.tip-w').click(function () {
                $('.tip-w').fadeOut(200);
            })

            $('.share').click(function () {
                $('.tip-w').fadeIn(200);
            })


            $('.duohdbox').click(function () {
                if ($(this).attr('cls') == 'a') {
                    $('.duohdbox-cont').hide();
                    $('.duohdbox').children('.ceng1').show();
                    $('.duohdbox').children('.ceng2').hide();
                    $('.duohdbox').css('padding', '10px');
                    $('.duohdbox').children('.adimg').css('border-radius', '5px');
                    $('.duohdbox').attr('cls', 'a');


                    $(this).next('.duohdbox-cont').show();
                    $(this).children('.ceng1').hide();
                    $(this).children('.ceng2').show();
                    $(this).css('padding', '0px')
                    $(this).children('.adimg').css('border-radius', '0px')
                    $(this).attr('cls', 'b');
                    $("html,body").animate({ scrollTop: $(this).offset().top }, 0);
                    if ($(this).find(".duohdbox-cont ul li").length == 0)
                        getActItem($(this).attr("data-id"))

                } else {
                    $('.duohdbox-cont').hide();
                    $('.duohdbox').children('.ceng1').show();
                    $('.duohdbox').children('.ceng2').hide();
                    $('.duohdbox').css('padding', '10px');
                    $('.duohdbox').children('.adimg').css('border-radius', '5px');
                    $('.duohdbox').attr('cls', 'a');

                    $(this).next('.duohdbox-cont').hide();
                    $(this).children('.ceng1').show();
                    $(this).css('padding', '10px');
                    $(this).children('.adimg').css('border-radius', '5px');
                    $(this).children('.ceng2').hide();
                }
            })
        })

    </script>
    <div class="tip-w">
        <div class="tip"><img src="/consumer/image/icon09.png" /></div>
    </div>
    <div id="list">

    </div>
    
    <footer>
        <div class="space2"></div>
        <div class="share">推荐给朋友 <img src="/consumer/image/icon07_2.png" /></div>
        <div class="bottomnav">
            <div class="logo1" onclick="location.href='index.html'"><img src="/consumer/image/logo.png" /></div>
            <a href="/consumer/page/retailerlist.html">
                <div class="nav" style="background:#ff6600;"><img src="/consumer/image/icon05.png" /><br />附近门店</div>
            </a>
            <a href="/consumer/page/activitylist.html">
                <div class="nav"><img src="/consumer/image/icon06.png" /><br />附近超惠</div>
            </a>
        </div>
    </footer>
    <script>

        function loaddata() {
		 
		var ajaxdata = { };
		if (wxjsconfig.sharekey != null)
			ajaxdata[wxjsconfig.sharekey] = "_";
			var search = window.location.search;
			if (search.length > 0)
			{
				var keyvalue=[];
				var key="",value=""; 
				var paraString=search.substring(search.indexOf("?")+1,search.length).split("&");
				for(var i in paraString)
				{					
					keyvalue=paraString[i].split("=");
					key=keyvalue[0];
					value=keyvalue[1];
					ajaxdata[key]=value; 					
				} 
			}
            $.ajax({
                type: 'GET',
                dataType: 'json',
                url: '/webapi/consumer/weixin/shareactivities',
                data: ajaxdata,
                beforeSend: function () { $(".pin-spinner").show(); },
                complete: function () { $(".pin-spinner").hide(); },
                success: function (jsondata) {

                    $(".pin-spinner").hide();//数据请求成功即隐藏转圈动画

                    jsondata = jsondata || {};
                    if (jsondata.error) {
                        toasterextend.showtips(jsondata.error, "error", false);
                        return;
                    }

                    if (jsondata.user_notification != undefined) {
                        toasterextend.showtips(jsondata.user_notification, "info");
                        return;
                    }

                    if (jsondata.data == undefined || jsondata.data.length == 0) {
                        //$("#list").html(' <img src="/consumer/image/acnull.png"  style="width:100%;margin-top:120px;" />');
                        return;
                    }

                    var content = "";
                    for (var i = 0; i < jsondata.data.length; i++) {
                        var obj = jsondata.data[i];
                        var flag;
                        if (obj.activity_flag == 0)
                            flag = "没开始";
                        else if (obj.activity_flag == 1)
                            flag = "进行中";
                        else if (obj.activity_flag == 2)
                            flag = "已结束";
                        content += '<div class="duohdbox-w" data-id="duohd_' + obj.activity_id + '">'
                            + '<div class="duohdbox" cls=a> <div class="adimg"><img src="' + obj.posterpic + '" /></div>'
                            + '<div class="ceng1"><div class="tit">' + obj.activitytitle + '</div><div class="time">' + getFormatDate(obj.begintime) + '至' + getFormatDate(obj.endtime) + '</div>'
                            + '<div class="statebox"><div class="statebtn1">' + flag + '</div><div class="arrowbottom"><img src="/consumer/image/icon10.png" /></div></div></div><div class="ceng2">' + flag + '</div></div>'
                            + '<div class="duohdbox-cont">'
                            + '<div class="dpdetail-info"><div class="hdname">' + obj.activitytitle + '</div><div class="hdtime1"><img src="/consumer/image/icon02_2.png" />' + obj.begintime + '至' + obj.endtime + '</div></div>'
                            + '<div class="chdetail-textbox">'
                            + '<div class="chtext-tit"><div class="bgline"></div><div class="bgcolor"></div><div class="tit">更正说明</div></div>'
                            + '<div class="chdetail-cont">' + obj.description + '</div></div>'
                            + '<div class="chdetail-textbox" style="padding-top:15px;">'
                            + ' <div class="chtext-tit"><div class="bgline2"></div>div class="bgcolor2"></div><div class="tit">优惠详情</div></div></div> '
                            + '<ul class="ul-list"></ul>'
                            + '<div class="more-md-w"><div class="more-md">'
                            + '<div class="text">活动共有<span>' + obj.retailer_count + '</span>家门店参加<br />看看有没有您附近的! </div><a href="#"> <div class="btn">点击查看</div></a></div></div>'
                            + '<div class="chdetail-textbox" style=" border-bottom:1px=border-bottom:1px solid #ccc;">'
                            + '<div class="chtext-tit"><div class="bgline2"></div><div class="bgcolor2"></div><div class="tit">补充信息</div></div><div class="chdetail-cont2">' + obj.description + '</div>'
                            + '</div><div class="ewmboxz"><img class="ewm" src="' + obj.posterpic + '" /><br />长按上方二维码图片关注超惠买<br /><img class="adtext" src="/consumer/image/adtext.png" /></div></div></div>';
                    }
                    $("#list").html(content);
					if ($.isFunction(wxjsshare)) {
						wxjsshare(jsondata.share || { });
					}
					qrcode.show();					
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    $(".pin-spinner").hide();//隐藏转圈动画

                    var errormsg = "访问异常";

                    if (XMLHttpRequest.status != null && XMLHttpRequest.status != 200) {
                        errormsg = "Http error: " + XMLHttpRequest.statusText;
                    }

                    toasterextend.showtips(errormsg, "error");
                }
            });
        };
    </script>
</body>
</html>
